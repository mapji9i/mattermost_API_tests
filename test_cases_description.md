
## Общие положения
Тестирование проводится с целью подтверждения заявленного разработчиком функционала API mattermost.
Согласно документации данный сервис предназначен для корпоративного и частного использования и предоставляет широкий фукнционал для совершения переписок, передачи  файлов, звонков и т.д. 
что предоставляют современные мессенджеры. Неосопоримым преимущством данной системы является возможность развртывания на серверах пользователя,что исключает утечки информации за пределы корпоративной сети.
В начале выполнения настоящего тестового задания данный сервис был развернут в докер контейнере (согласно документации на сайте разработчка https://docs.mattermost.com/deploy/server/deploy-containers.html), 
на том же ПК на котором происходило тестирование. Базовый URL для доступа к API в условиях тестирования [http://localhost:8065/](http://localhost:8065/api/v4/)
___

## 1. Попытаться войти в систему с неверными логином и паролем пользователя
Отправить POST запрос c JSON типа:
{
  "login_id": "string",
  "password": "string"
}
на
http://localhost:8065/api/v4/users/login
С неверными учетными данными пользователя.
Распарсить JSON-ответ, получить статус код ответа,
проверить сообщение об ошибке
| №   | Шаги                                              | Тестовые данные                             | Ожидаемый результат |
|-----|---------------------------------------------------|---------------------------------------------|---------------------|
| 1.1 | Проверить статус-код                              | id, полученный из POST-запроса              | Статус-код 401      |
| 1.2 | Проверить содержимое JSON-ответа                   | json, полученный из POST-запроса              | JSON Типа*          |
|1.3| Проверить содежимое поля message                | json, полученный из POST-запроса| "Enter a valid email or username and/or password."
|1.4| Проверить содежимое поля id                | json, полученный из POST-запроса| "api.user.login.invalid_credentials_email_username"


*Ожидаемый формат JSON-ответа для п.п. 1.2  

{
  "status_code": int,
  "id": "string",
  "message": "string",
  "request_id": "string"
}

___
## 2. Попытаться войти в систему с учетными данными заблокированного пользователя
Отправить POST запрос c JSON типа:
{
  "login_id": "string",
  "password": "string"
}
на
http://localhost:8065/api/v4/users/login
С данными заблокированного пользователя.
Распарсить JSON-ответ, получить статус код ответа, получить идентификатор ошибки,
проверить сообщение об ошибке
| №   | Шаги                                              | Тестовые данные                             | Ожидаемый результат |
|-----|---------------------------------------------------|---------------------------------------------|---------------------|
| 2.1 | Проверить статус-код                              | id, полученный из POST-запроса              | Статус-код 401      |
| 2.2 | Проверить содержимое JSON-ответа                   | json, полученный из POST-запроса              | JSON Типа*          |
|2.3| Проверить содежимое поля message                | json, полученный из POST-запроса| "Login failed because your account has been deactivated.  Please contact an administrator."
|2.4| Проверить содежимое поля id                | json, полученный из POST-запроса| "api.user.login.inactive.app_error"


*Ожидаемый формат JSON-ответа для теста 2.2
{
  "status_code": int,
  "id": "string",
  "message": "string",
  "request_id": "string"
}


___
## 3. Симулирвать отсутствие соединения с сервером аутентификации
Для осуществления данного теста было принято решение остановить контейнер с базой данных sql, чтобы mattermost не мог получить user_details при аутентификации пользователя. 
Тем самым можно считать что сервер авторизации не сможет отработать свой функционал.
Затем отправить POST запрос c JSON типа:
{
  "login_id": "string",
  "password": "string"
}
на
http://localhost:8065/api/v4/users/login
При этом не важно активный или заблокированный пользователь.
Распарсить JSON-ответ, получить статус код ответа, получить идентификатор ошибки,
проверить сообщение об ошибке
| №   | Шаги                                              | Тестовые данные                             | Ожидаемый результат |
|-----|---------------------------------------------------|---------------------------------------------|---------------------|
| 3.1 | Проверить статус-код                              | id, полученный из POST-запроса              | Статус-код 401      |
| 3.2 | Проверить содержимое JSON-ответа                   | json, полученный из POST-запроса              | JSON Типа*          |
|3.3| Проверить содежимое поля message                | json, полученный из POST-запроса| "Login failed because email address has not been verified."
|3.4| Проверить содежимое поля id                | json, полученный из POST-запроса| "api.user.login.not_verified.app_error"


*Ожидаемый формат JSON-ответа для теста 3.2
{
  "status_code": int,
  "id": "string",
  "message": "string",
  "request_id": "string"
}

## 4. Попытаться войти в систему с учетными данными не активированного пользователя
Отправить POST запрос c JSON типа:
{
  "login_id": "string",
  "password": "string"
}
на
http://localhost:8065/api/v4/users/login
С данными не активированного пользователя.
Распарсить JSON-ответ, получить статус код ответа, получить идентификатор ошибки,
проверить сообщение об ошибке
| №   | Шаги                                              | Тестовые данные                             | Ожидаемый результат |
|-----|---------------------------------------------------|---------------------------------------------|---------------------|
| 4.1 | Проверить статус-код                              | id, полученный из POST-запроса              | Статус-код 401      |
| 4.2 | Проверить содержимое JSON-ответа                   | json, полученный из POST-запроса              | JSON Типа*          |
|4.3| Проверить содежимое поля message                | json, полученный из POST-запроса| "Login failed because email address has not been verified."
|4.4| Проверить содежимое поля id                | json, полученный из POST-запроса| "api.user.login.not_verified.app_error"


*Ожидаемый формат JSON-ответа для теста 4.2
{
  "status_code": int,
  "id": "string",
  "message": "string",
  "request_id": "string"
}

___
## 5. Проверка успешного создания чата/канала
Отправить POST-запрос c JSON типа:  
{
  "team_id": "string",
  "name": "string",
  "display_name": "string",
  "purpose": "string",
  "header": "string",
  "type": "string"
}
C заголовком, содержащим токен доступа
Authorization: "Bearer {YOUR_TOKEN}"

на
http://localhost:8065/api/v4/channels
Распарсить JSON-ответ, получить статус код ответа, сверить заданные и полученные значения полей

| №   | Шаги                                              | Тестовые данные                             | Ожидаемый результат |
|-----|---------------------------------------------------|---------------------------------------------|---------------------|
| 5.1 | Проверить статус-код                              | id, полученный из POST-запроса              | Статус-код 201   |
| 5.2 | Проверить содержимое JSON-ответа                   | json, полученный из POST-запроса              | JSON Типа*          |
|5.3| Проверить содежимое поля team_id                | json, полученный из POST-запроса| Данное значение должно соответствовать указанному в запросе
|5.4| Проверить содежимое поля display_name                | json, полученный из POST-запроса| Данное значение должно соответствовать указанному в запросе
|5.5| Проверить содежимое поля name                | json, полученный из POST-запроса| Данное значение должно соответствовать указанному в запросе
|5.6| Проверить содежимое поля purpose                | json, полученный из POST-запроса| Данное значение должно соответствовать указанному в запросе
|5.7| Проверить содежимое поля header               | json, полученный из POST-запроса| Данное значение должно соответствовать указанному в запросе

*Ожидаемый формат JSON-ответа для теста 5.2
{
  "id": "string",
  "create_at": -9007199254740991,
  "update_at": -9007199254740991,
  "delete_at": -9007199254740991,
  "team_id": "string",
  "type": "string",
  "display_name": "string",
  "name": "string",
  "header": "string",
  "purpose": "string",
  "last_post_at": -9007199254740991,
  "total_msg_count": 0,
  "extra_update_at": -9007199254740991,
  "creator_id": "string"
}

**Дополнительно можно сделать GET запрос на http://localhost:8065/api/v4/channels
C заголовком, содержащим токен доступа пользователя имеющего права на администирование каналов
Authorization: "Bearer {ADMIN_TOKEN}"
Вид ожидаемого ответа:

[
  {
    "id": "string",
    "create_at": 0,
    "update_at": 0,
    "delete_at": 0,
    "team_id": "string",
    "type": "string",
    "display_name": "string",
    "name": "string",
    "header": "string",
    "purpose": "string",
    "last_post_at": 0,
    "total_msg_count": 0,
    "extra_update_at": 0,
    "creator_id": "string",
    "team_display_name": "string",
    "team_name": "string",
    "team_update_at": 0,
    "policy_id": "string"
  }
]

Требуется проверить наличие только что созданного чата в данном листе json`ов, например найдя его id.

## 6. Проверка создания канала с уже существующим названием
Планируется данный тест проводить сразу после с теста 5, используя данные задейтвованные для создания чата в нем. 
Повторно отправить POST-запрос c JSON типа из теста 5:  
{
  "team_id": "string",
  "name": "string",
  "display_name": "string",
  "purpose": "string",
  "header": "string",
  "type": "string"
}
C заголовком, содержащим токен доступа
Authorization: "Bearer {YOUR_TOKEN}"

на
http://localhost:8065/api/v4/channels
Распарсить JSON-ответ, получить статус код ответа, получить идентификатор ошибки,
проверить сообщение об ошибке
| №   | Шаги                                              | Тестовые данные                             | Ожидаемый результат |
|-----|---------------------------------------------------|---------------------------------------------|---------------------|
| 6.1 | Проверить статус-код                              | id, полученный из POST-запроса              | Статус-код 400      |
| 6.2 | Проверить содержимое JSON-ответа                   | json, полученный из POST-запроса              | JSON Типа*          |
|6.3| Проверить содежимое поля message                | json, полученный из POST-запроса| "A channel with that name already exists on the same team.",
|6.4| Проверить содежимое поля id                | json, полученный из POST-запроса|  "store.sql_channel.save_channel.exists.app_error"

*Ожидаемый формат JSON-ответа для теста 6.2
{
  "status_code": int,
  "id": "string",
  "message": "string",
  "request_id": "string"
}
Если смешивать тесты в один пайплайн не хочется то можно аналогично примечанию ** к тесту 5 сделать запрос,
и получить данные какого нибудь уже существующего канала (если вернется не пустой список), и их использовать для данного теста.

## 7. Проверка отправки сообщения в чат/канал
Для выполнения теста, требуется заранее созданный канал/чат. 
Можно воспользоваться данными из теста 5. Либо создать его в методе SetUp.Либо получить его аналогично ** из 5.
Главное извлечь значение в поле channel_id.
Так же для более точной верификации нужно при тестировании иметь значение user_id для пользователя,
от имени которого отправляется сообщение, и которому соответствует токен доступа в заголовке запроса.

Затем отправить POST-запрос c JSON типа:  
{
  "channel_id": "string",
  "message": "string"
}
C заголовком, содержащим токен доступа
Authorization: "Bearer {YOUR_TOKEN}"

на http://localhost:8065/api/v4/posts
Распарсить JSON-ответ, получить статус код ответа, сравнить занные и полученные значения
| №   | Шаги                                              | Тестовые данные                             | Ожидаемый результат |
|-----|---------------------------------------------------|---------------------------------------------|---------------------|
| 7.1 | Проверить статус-код                              | id, полученный из POST-запроса              | Статус-код 201      |
| 7.2 | Проверить содержимое JSON-ответа                   | json, полученный из POST-запроса              | JSON Типа*          |
|7.3| Проверить содержимое поля message                | json, полученный из POST-запроса| Соответствует значению поля "message" в теле запроса
|7.4| Проверить содержимое поля channel_id                | json, полученный из POST-запроса|  Соответствует значению поля "channel_id" в теле запроса
|7.5| Проверить содержимое поля user_id                | json, полученный из POST-запроса|  Соответствует значению user_id пользователя от имени которого отправляет запрос

*Ожидаемый формат JSON-ответа для теста 7.2
{
  "id": "string",
  "create_at": -9007199254740991,
  "update_at": -9007199254740991,
  "delete_at": -9007199254740991,
  "edit_at": -9007199254740991,
  "user_id": "string",
  "channel_id": "string",
  "root_id": "string",
  "original_id": "string",
  "message": "string",
  "type": "string",
  "props": {},
  "hashtag": "string",
  "file_ids": [
    "string"
  ],
  "pending_post_id": "string",
  "metadata": {
    "embeds": [
      {
        "type": "image",
        "url": "string",
        "data": {}
      }
    ],
    "emojis": [
      {
        "id": "string",
        "creator_id": "string",
        "name": "string",
        "create_at": 0,
        "update_at": 0,
        "delete_at": 0
      }
    ],
    "files": [
      {
        "id": "string",
        "user_id": "string",
        "post_id": "string",
        "create_at": 0,
        "update_at": 0,
        "delete_at": 0,
        "name": "string",
        "extension": "string",
        "size": 0,
        "mime_type": "string",
        "width": 0,
        "height": 0,
        "has_preview_image": true
      }
    ],
    "images": {},
    "reactions": [
      {
        "user_id": "string",
        "post_id": "string",
        "emoji_name": "string",
        "create_at": 0
      }
    ],
    "priority": {
      "priority": "string",
      "requested_ack": true
    },
    "acknowledgements": [
      {
        "user_id": "string",
        "post_id": "string",
        "acknowledged_at": 0
      }
    ]
  }
}


## 8. Проверка получения сообщений из чата/канала
В данном тесте можно воспользоваться сохраненным значение message_id из теста 7,
но по условию задания это и не требуется.
Требуется значение channel_id не пустого чата

Затем отправить GET-запрос c заголовком, содержащим токен доступа
Authorization: "Bearer {YOUR_TOKEN}"

на 
http://localhost:8065/api/v4/channels/{channel_id}/posts
Распарсить JSON-ответ, получить статус код ответа, проверить наличие сообщения из теста 7.
| №   | Шаги                                              | Тестовые данные                             | Ожидаемый результат |
|-----|---------------------------------------------------|---------------------------------------------|---------------------|
| 8.1 | Проверить статус-код                              | id, полученный из GET-запроса              | Статус-код 200      |
| 8.2 | Проверить содержимое JSON-ответа                   | json, полученный из GET-запроса              | JSON Типа*          |
|8.3| Проверить наличие сообщения текстом и message_id из теста 7                | json, полученный из POST-запроса| Соответствует значению поля "message" в теле запроса теста 7

## 9. Проверка добавления пользователей в чат/канал
Требуется значение channel_id и один или более user_id

Отправить POST-запрос 
{
  "user_ids": [
    "string"
  ]
}

c заголовком, содержащим токен доступа
Authorization: "Bearer {YOUR_TOKEN}"
на 
http://localhost:8065/api/v4/channels/{channel_id}/members
Распарсить JSON-ответ, получить статус код ответа, проверить наличие в ответе заявленных пользователей
| №   | Шаги                                              | Тестовые данные                             | Ожидаемый результат |
|-----|---------------------------------------------------|---------------------------------------------|---------------------|
| 9.1 | Проверить статус-код                              | id, полученный из POST-запроса              | Статус-код 201     |
| 9.2 | Проверить содержимое JSON-ответа                   | json, полученный из POST-запроса              | JSON Типа*          |
|9.3| Проверить наличие в ответе пользоватлей с заявленными user_id              | json, полученный из POST-запроса| В ответе присутствуют переданные user_id

## 9. Проверка добавления пользователей в чат/канал
Требуется значение channel_id с двумя или более пользователями
И значнеие user_id присутствующее в данном канале
Отправить DELETE-запрос 

c заголовком, содержащим токен доступа
Authorization: "Bearer {YOUR_TOKEN}"
на 
http://localhost:8065/api/v4/channels/{channel_id}/members/{user_id}
Распарсить JSON-ответ, получить статус код ответа, проверить наличие в ответе заявленных пользователей
| №   | Шаги                                              | Тестовые данные                             | Ожидаемый результат |
|-----|---------------------------------------------------|---------------------------------------------|---------------------|
| 10.1 | Проверить статус-код                              | id, полученный из DELETE-запроса              | Статус-код 200     |
| 10.2 | Проверить содержимое JSON-ответа                   | json, полученный из DELETE-запроса              | JSON Типа*          |


*Ожидаемый формат JSON-ответа для теста 10.2
{
  "status": "string"
}

